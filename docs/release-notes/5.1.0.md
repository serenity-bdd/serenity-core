# Serenity BDD 5.1.0 Release Notes

**New Playwright Integration for Step Libraries**

This release introduces the new `serenity-playwright` module, providing lightweight integration between Serenity BDD's powerful reporting and Microsoft Playwright's modern browser automation. This enables teams to use Playwright with Serenity's `@Step` annotated methods and automatic screenshot capture.

## What's New

### Serenity Playwright Module

A new `serenity-playwright` module brings Playwright support to Serenity step libraries:

- **Automatic Screenshot Capture**: Screenshots are captured at each `@Step` method completion and included in Serenity reports
- **Simple Registration API**: Register Playwright Page instances with a single method call
- **Thread-Safe Design**: Supports parallel test execution with proper thread isolation
- **Page Object Pattern Support**: Works seamlessly with the recommended three-layer architecture (Tests → Step Libraries → Page Objects)

#### Basic Usage

```java
@ExtendWith(SerenityJUnit5Extension.class)
class MyTest {
    @Steps
    SearchSteps search;

    private Page page;

    @BeforeEach
    void setup() {
        page = browser.newPage();
        PlaywrightSerenity.registerPage(page);  // Enable screenshot capture
    }

    @AfterEach
    void cleanup() {
        PlaywrightSerenity.unregisterPage(page);
        page.close();
    }

    @Test
    void shouldSearchSuccessfully() {
        search.openHomePage(page);
        search.searchFor(page, "Serenity BDD");
        search.verifyResultsContain(page, "Serenity");
    }
}
```

#### Key API Methods

| Method | Description |
|--------|-------------|
| `PlaywrightSerenity.registerPage(page)` | Register a page for screenshot capture |
| `PlaywrightSerenity.unregisterPage(page)` | Unregister a page when done |
| `PlaywrightSerenity.getCurrentPage()` | Get the most recently registered page |
| `PlaywrightSerenity.takeScreenshot()` | Manually trigger screenshot capture |

### Meta-Annotation Support for JUnit 5

The `SerenityTestExecutionListener` now properly detects Serenity extensions when they are applied via meta-annotations (composed annotations):

```java
// Custom composed annotation
@ExtendWith(SerenityJUnit5Extension.class)
@ExtendWith(SerenityPlaywrightExtension.class)
@Retention(RetentionPolicy.RUNTIME)
public @interface SerenityPlaywright {}

// Now works correctly - JSON reports are generated
@SerenityPlaywright
class MyTest { ... }
```

Previously, tests using composed annotations like `@SerenityPlaywright` would not generate JSON report files when run via Maven, even though they worked in IDEs. This fix ensures report generation works consistently regardless of how Serenity extensions are applied.

### Improved Failure Reporting

#### Feature Reports Now Highlight the Failing Step (#3690)
- Feature and requirements reports now highlight the specific Gherkin step that failed within each scenario
- Previously, you could only see that a scenario failed, not which step caused the failure
- Now the failing step is highlighted inline with a red accent, making it immediately visible
- Works correctly for both regular scenarios and Scenario Outlines

#### Most Frequent Failures Now Shows Actual Error Messages
- The "Most Frequent Failures" section on the report home page now displays the actual error message instead of just the exception type
- Previously, all assertion failures were grouped together as "Assertion failed error" regardless of the actual error
- Now you'll see the specific error messages like "Expected 'Search' but was 'Login'" or "Element '#submit-btn' not found"
- Error messages are truncated to 80 characters to keep the display clean

## What's Changed

### Bug Fixes

- **Meta-annotation detection**: Fixed `SerenityTestExecutionListener.isSerenityTestClass()` to check annotations on meta-annotations, enabling JSON report generation for tests using composed annotations like `@SerenityPlaywright`

## Maven Coordinates

```xml
<dependency>
    <groupId>net.serenity-bdd</groupId>
    <artifactId>serenity-playwright</artifactId>
    <version>5.1.0</version>
    <scope>test</scope>
</dependency>
```

The module requires Playwright 1.57.0 or higher.

## Why This Matters

- **Modern Browser Automation**: Teams can now use Playwright's fast, reliable, auto-waiting browser automation with Serenity's rich reporting
- **Familiar Patterns**: The three-layer architecture (Tests → Step Libraries → Page Objects) works naturally with Playwright
- **Better Reporting**: Automatic screenshots at each step provide detailed visual documentation of test execution
- **Cross-Browser Testing**: Leverage Playwright's excellent cross-browser support (Chromium, Firefox, WebKit) with Serenity reports
- **Simpler Test Setup**: No need for the full Screenplay pattern - use simple `@Step` annotated methods with Playwright
- **Quick Failure Triage**: Seeing the failing step name directly in feature reports lets teams quickly triage failures without opening each test
- **Better Failure Identification**: Teams can now quickly identify the most common actual errors in their test suite, not just the exception types

## Documentation

Full documentation for the Serenity Playwright integration is available at:
- [Introduction to Serenity Playwright](https://serenity-bdd.github.io/docs/playwright/playwright_intro)
- [Getting Started Guide](https://serenity-bdd.github.io/docs/playwright/playwright_getting_started)
- [Page Objects](https://serenity-bdd.github.io/docs/playwright/playwright_page_objects)
- [Step Libraries](https://serenity-bdd.github.io/docs/playwright/playwright_step_libraries)
- [Configuration Options](https://serenity-bdd.github.io/docs/playwright/playwright_configuration)
- [Best Practices](https://serenity-bdd.github.io/docs/playwright/playwright_best_practices)

---

**Full Changelog**: https://github.com/serenity-bdd/serenity-core/compare/5.0.4...5.1.0
