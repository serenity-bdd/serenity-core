# Serenity BDD 5.3.1 Release Notes

**`@Nested` Class Support for `@Epic`, `@Feature`, `@Story` Annotations**

This patch release fixes an issue where JUnit 5 `@Nested` inner classes did not inherit `@Epic`, `@Feature`, and `@Story` annotations from their enclosing (outer) class. This caused the requirements hierarchy in Serenity reports to appear flat instead of properly nested.

## Bug Fix

### `@Nested` Classes Now Inherit Requirements Annotations from Enclosing Classes

Previously, annotations like `@Feature` on an outer class were not picked up by tests in a `@Nested` inner class. This was because the annotation lookup only walked the superclass (`extends`) chain, not the enclosing class (inner/outer) chain.

**Before (5.3.0):**
```java
@Feature("Product Catalog")
class ProductCatalogTests {

    @Nested
    @Story("Searching by keyword")
    class WhenSearchingByKeyword {
        @Test
        void shouldFindProducts() { /* ... */ }
    }
}
```
The story "Searching by keyword" appeared as a top-level item in the report, disconnected from the "Product Catalog" feature.

**After (5.3.1):**

The same code now correctly produces the expected hierarchy:

```
Product Catalog (feature)
└── Searching by keyword (story)
    └── Should find products
```

This works for all combinations:
- `@Feature` on outer class + `@Story` on nested class
- `@Epic` on outer class + `@Feature`/`@Story` on nested class
- Full three-level hierarchy: `@Epic` + `@Feature` on outer, `@Story` on nested

If the nested class redefines an annotation already present on the outer class, the nested class annotation takes precedence.

### Affected Components

Two methods were updated to walk the enclosing class chain:
- `EpicFeatureStoryAnnotations.forClass()` — generates TestTags from annotations
- `Story.fromAnnotationsOn()` — builds the Story with the requirements hierarchy path

## Upgrade

```xml
<dependency>
    <groupId>net.serenity-bdd</groupId>
    <artifactId>serenity-core</artifactId>
    <version>5.3.1</version>
</dependency>
```

## Documentation

- [Inheriting Annotations in @Nested Classes](https://serenity-bdd.github.io/docs/guide/annotation-requirements#inheriting-annotations-in-junit-5-nested-classes) — full guide with examples
- [JUnit 5 Nested Tests](https://serenity-bdd.github.io/docs/junit5/junit5-tests#nested-classes-and-requirements-annotations) — quick reference

---

**Full Changelog**: https://github.com/serenity-bdd/serenity-core/compare/5.3.0...5.3.1
