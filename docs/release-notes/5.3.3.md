# Serenity BDD 5.3.3 Release Notes

**Playwright Property-Driven Configuration, Automatic Page Injection, and Screenshot Capture**

This release significantly improves the Playwright integration with property-driven configuration, automatic `Page` injection into step libraries, screenshot capture in reports, and `OptionsFactory` support in `PlaywrightCast`.

## New Features

### Serenity Property Fallbacks for Playwright Configuration

You can now configure browser channel, base URL, and slow-motion delay via `serenity.properties`, `serenity.conf`, or `-D` flags — without writing code or creating a custom `OptionsFactory`. These properties act as fallbacks: values set programmatically always take precedence.

| Property | Type | Description |
|----------|------|-------------|
| `playwright.channel` | `String` | Browser channel (e.g. `"chrome"`, `"msedge"`) |
| `playwright.baseurl` | `String` | Base URL for `page.navigate()` with relative paths |
| `playwright.slowmo` | `Double` | Slows down Playwright operations by the given milliseconds |

These join the existing `playwright.browsertype`, `playwright.headless`, and `playwright.tracing` properties.

**Example:**

```bash
mvn verify -Dplaywright.channel=chrome -Dplaywright.baseurl=https://staging.example.com -Dplaywright.slowmo=200
```

Or in `serenity.properties`:

```properties
playwright.channel=chrome
playwright.baseurl=https://staging.example.com
playwright.slowmo=200
```

This works with both `PlaywrightBrowserManager` (step library / Cucumber approach) and `BrowseTheWebWithPlaywright` (Screenplay approach).

### Automatic Playwright Page Injection into Step Libraries

Step libraries can now declare a `Page` constructor parameter and Serenity will automatically inject a lazy proxy to the current Playwright page. This removes boilerplate and simplifies step library design:

```java
public class SearchSteps {
    private final Page page;

    public SearchSteps(Page page) {
        this.page = page;
    }

    @Step("Search for {0}")
    public void searchFor(String term) {
        page.getByRole(AriaRole.TEXTBOX).fill(term);
        page.getByRole(AriaRole.BUTTON, new Page.GetByRoleOptions().setName("Search")).click();
    }
}
```

The `Page` proxy is resolved lazily — locators obtained from the page during construction (e.g. `this.email = page.getByLabel("Email")`) work correctly even before the real page is available.

**How it works:** A new SPI-based `StepParameterProvider` mechanism allows modules to supply constructor arguments for `@Steps`-annotated step libraries. The `serenity-playwright` module ships a `PlaywrightPageProvider` that uses this SPI to inject `Page` instances automatically.

### Playwright Screenshot Capture in Reports

Playwright tests now automatically capture screenshots in Serenity reports. The `PlaywrightStepListener` records screenshots at step completion and on failure, including full-page captures and HTML source for debugging. This works transparently — no configuration needed beyond having `serenity-playwright` on the classpath.

### PlaywrightCast Support for OptionsFactory

`PlaywrightCast` now accepts a Playwright `OptionsFactory`, letting you reuse the same configuration class used with `@UsePlaywright`:

```java
@Before(order = 0)
public void setTheStage(Scenario scenario) {
    OnStage.setTheStage(
        new PlaywrightCast()
            .withOptions(new ChromeHeadlessOptions())  // reuse your OptionsFactory
    );
}
```

## Improvements

### PlaywrightOptionsResolver Extraction

Launch option, context option, and connect-over-WebSocket resolution logic has been extracted into a shared `PlaywrightOptionsResolver` utility. Both `PlaywrightBrowserManager` and `BrowseTheWebWithPlaywright` now delegate to the same code, eliminating duplication and ensuring consistent behavior.

### JUnit 5 Compatibility with Alternative Test Frameworks

The JUnit 5 integration now handles frameworks like Spock that report display names instead of actual method names, improving manual test annotation detection.

## Affected Components

| Component | Change |
|-----------|--------|
| `PlayWrightConfigurationProperties` | New `CHANNEL`, `BASE_URL`, `SLOW_MO` enum values + `asDoubleFrom()` accessor |
| `PlaywrightBrowserManager` | Property fallbacks for channel, slowMo, baseURL |
| `BrowseTheWebWithPlaywright` | Property fallbacks for channel, slowMo, baseURL |
| `StepParameterProvider` | **New** SPI interface for pluggable constructor parameter resolution |
| `StepFactory` | Enhanced to resolve constructor parameters via SPI |
| `PlaywrightPageProvider` | **New** SPI implementation providing `Page` injection |
| `PlaywrightStepListener` | Screenshot capture at step completion and on failure |
| `PlaywrightCast` | New `withOptions(OptionsFactory)` method |
| `PlaywrightOptionsResolver` | **New** shared utility for Options resolution |
| `SerenityTestExecutionListener` | Improved method resolution for alternative frameworks |

## Upgrade

```xml
<dependency>
    <groupId>net.serenity-bdd</groupId>
    <artifactId>serenity-core</artifactId>
    <version>5.3.3</version>
</dependency>
```

No code changes are required. This is a drop-in replacement for 5.3.2.

---

**Full Changelog**: https://github.com/serenity-bdd/serenity-core/compare/5.3.2...5.3.3
