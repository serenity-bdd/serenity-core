# Serenity BDD 5.2.1 Release Notes

**Enhanced Playwright Screenplay with UI Factories and Advanced Capabilities**

This release significantly expands the `serenity-screenplay-playwright` module with UI element factories for cleaner locators, advanced testing capabilities including visual regression testing, accessibility testing, and device emulation.

## What's New

### UI Element Factories

New factory classes for locating common UI elements using Playwright's powerful selector syntax:

```java
import net.serenitybdd.screenplay.playwright.ui.*;

// Buttons
alice.attemptsTo(Click.on(Button.withText("Submit")));
alice.attemptsTo(Click.on(Button.withAriaLabel("Close dialog")));

// Input fields
alice.attemptsTo(Enter.theValue("john@example.com").into(InputField.withLabel("Email")));
alice.attemptsTo(Enter.theValue("Search...").into(InputField.withPlaceholder("Search products")));

// Links
alice.attemptsTo(Click.on(Link.containingText("documentation")));

// Checkboxes and Radio buttons
alice.attemptsTo(Click.on(Checkbox.withLabel("Accept terms")));
alice.attemptsTo(Click.on(RadioButton.withValue("express")));

// Dropdowns
alice.attemptsTo(SelectFromOptions.byVisibleText("Canada").from(Dropdown.withLabel("Country")));

// Images
alice.attemptsTo(Click.on(Image.withAltText("Product thumbnail")));
```

| Factory | Key Methods |
|---------|-------------|
| `Button` | `withText()`, `withNameOrId()`, `withAriaLabel()`, `containingText()` |
| `InputField` | `withNameOrId()`, `withPlaceholder()`, `withLabel()`, `withAriaLabel()` |
| `Link` | `withText()`, `containingText()`, `withTitle()` |
| `Checkbox` | `withLabel()`, `withNameOrId()`, `withValue()` |
| `RadioButton` | `withLabel()`, `withNameOrId()`, `withValue()` |
| `Dropdown` | `withLabel()`, `withNameOrId()` |
| `Label` | `withText()`, `withExactText()`, `forFieldId()` |
| `Image` | `withAltText()`, `withSrc()`, `withSrcContaining()` |

### Deselect Operations

For multi-select dropdowns, deselect options:

```java
alice.attemptsTo(DeselectFromOptions.byValue("red").from("#colors"));
alice.attemptsTo(DeselectFromOptions.byVisibleText("Red").from("#colors"));
alice.attemptsTo(DeselectFromOptions.byIndex(0).from("#colors"));
alice.attemptsTo(DeselectFromOptions.all().from("#colors"));
```

### Comprehensive Scrolling

Enhanced scrolling capabilities:

```java
// Scroll to element with alignment
alice.attemptsTo(Scroll.to("#footer").andAlignToCenter());

// Page-level scrolling
alice.attemptsTo(Scroll.toTop());
alice.attemptsTo(Scroll.toBottom());
alice.attemptsTo(Scroll.by(0, 500));  // deltaX, deltaY
alice.attemptsTo(Scroll.toPosition(0, 1000));
```

### Absence Question

Check that elements are NOT present:

```java
boolean hasNoErrors = alice.asksFor(Absence.of("#error-message"));
```

### Drag and Drop Aliases

Alternative fluent syntax for drag operations:

```java
alice.attemptsTo(Drag.the("#card").onto("#column"));
```

### Visual Regression Testing

Compare screenshots against baselines:

```java
alice.attemptsTo(
    CompareScreenshot.ofPage()
        .againstBaseline("homepage.png")
        .withThreshold(0.01)
        .withMask("#timestamp", "#user-avatar")
);
```

### Accessibility Testing

Test accessibility compliance:

```java
String snapshot = alice.asksFor(AccessibilitySnapshot.ofThePage());
List<String> buttons = alice.asksFor(AccessibilitySnapshot.allWithRole(AriaRole.BUTTON));
```

### Device Emulation

Test responsive designs:

```java
alice.attemptsTo(EmulateDevice.device("iPhone 14"));
alice.attemptsTo(EmulateDevice.withViewport(375, 812).asMobile());
```

### Geolocation Testing

Test location-based features:

```java
alice.attemptsTo(GrantPermissions.for_("geolocation"));
alice.attemptsTo(SetGeolocation.toLondon());
alice.attemptsTo(SetGeolocation.to(51.5074, -0.1278).withAccuracy(100));
```

### Clock Control

Test time-dependent functionality:

```java
alice.attemptsTo(ControlClock.install());
alice.attemptsTo(ControlClock.setTo(Instant.parse("2024-01-15T10:30:00Z")));
alice.attemptsTo(ControlClock.advanceBy(Duration.ofHours(2)));
```

### Tracing

Record detailed traces for debugging:

```java
alice.attemptsTo(
    StartTracing.withScreenshots().andSnapshots().named("checkout-flow")
);

// ... perform actions ...

alice.attemptsTo(StopTracing.andSaveTo(Paths.get("traces/checkout.zip")));
// View with: npx playwright show-trace traces/checkout.zip
```

### PDF Generation

Generate PDFs from pages (Chromium headless):

```java
alice.attemptsTo(
    GeneratePDF.ofCurrentPage()
        .withFormat("A4")
        .inLandscape()
        .printBackground()
        .andSaveTo(Paths.get("report.pdf"))
);
```

### Console Message Capture

Capture and query browser console messages:

```java
alice.attemptsTo(CaptureConsoleMessages.duringTest());

// Query captured messages
List<String> errors = alice.asksFor(ConsoleMessages.errors());
List<String> warnings = alice.asksFor(ConsoleMessages.warnings());
int errorCount = alice.asksFor(ConsoleMessages.errorCount());
```

### Download Handling

Handle file downloads:

```java
alice.attemptsTo(
    WaitForDownload.whilePerforming(Click.on("#download-btn"))
        .andSaveTo(Paths.get("downloads/report.pdf"))
);

String filename = alice.asksFor(DownloadedFile.suggestedFilename());
```

## Maven Coordinates

```xml
<dependency>
    <groupId>net.serenity-bdd</groupId>
    <artifactId>serenity-screenplay-playwright</artifactId>
    <version>5.2.1</version>
    <scope>test</scope>
</dependency>
```

## Why This Matters

- **Cleaner Tests**: UI element factories make locators more readable and maintainable
- **Visual Testing**: Catch visual regressions automatically with screenshot comparison
- **Accessibility**: Verify ARIA compliance and accessibility patterns
- **Mobile Testing**: Test responsive designs with device emulation
- **Advanced Debugging**: Traces and console capture make debugging easier
- **Comprehensive Coverage**: Test time-dependent features, geolocation, downloads, and more

## Documentation

Full documentation is available at:
- [Serenity Screenplay Playwright Guide](https://serenity-bdd.github.io/docs/screenplay/screenplay_playwright)

---

**Full Changelog**: https://github.com/serenity-bdd/serenity-core/compare/5.2.0...5.2.1
