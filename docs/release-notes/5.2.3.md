# Serenity BDD 5.2.3 Release Notes

**`@UsePlaywright` Support for Simplified Browser Lifecycle Management**

This release adds support for Playwright's `@UsePlaywright` annotation alongside Serenity's JUnit 5 extensions, eliminating manual browser lifecycle management and making Playwright tests significantly simpler.

## What's New

### `@UsePlaywright` Annotation Support

You can now use Playwright's `@UsePlaywright` annotation together with Serenity's extensions. Playwright manages the full browser lifecycle (Playwright, Browser, BrowserContext, Page) while Serenity handles reporting and screenshot capture:

```java
@ExtendWith(SerenityJUnit5Extension.class)
@ExtendWith(SerenityPlaywrightExtension.class)
@UsePlaywright(ChromeHeadlessOptions.class)
class WhenSearchingTest {

    @Steps
    SearchSteps search;

    @BeforeEach
    void setUp(Page page) {
        search.setPage(page);
    }

    @Test
    void shouldSearchForResults() {
        search.openApplication();
        search.searchFor("Serenity BDD");
        assertThat(search.resultCount()).isGreaterThan(0);
    }
}
```

#### Before and After

**Before (manual lifecycle management):**

```java
@ExtendWith(SerenityJUnit5Extension.class)
class WhenSearchingTest {

    private Playwright playwright;
    private Browser browser;
    private Page page;

    @BeforeEach
    void setUp() {
        playwright = Playwright.create();
        browser = playwright.chromium().launch(
            new BrowserType.LaunchOptions().setHeadless(true)
        );
        page = browser.newPage();
        PlaywrightSerenity.registerPage(page);
        search.setPage(page);
    }

    @AfterEach
    void tearDown() {
        PlaywrightSerenity.unregisterPage(page);
        if (page != null) page.close();
        if (browser != null) browser.close();
        if (playwright != null) playwright.close();
    }
    // ...
}
```

**After (with `@UsePlaywright`):**

```java
@ExtendWith(SerenityJUnit5Extension.class)
@ExtendWith(SerenityPlaywrightExtension.class)
@UsePlaywright(ChromeHeadlessOptions.class)
class WhenSearchingTest {

    @BeforeEach
    void setUp(Page page) {
        search.setPage(page);
    }
    // ...
}
```

No manual `Playwright.create()`, `browser.launch()`, `page.close()`, or `PlaywrightSerenity.registerPage()` — it's all handled automatically.

#### Configuring Browser Options with `OptionsFactory`

Use `@UsePlaywright` with an `OptionsFactory` to configure browser launch options:

```java
public class ChromeHeadlessOptions implements OptionsFactory {
    @Override
    public Options getOptions() {
        return new Options()
                .setHeadless(true)
                .setLaunchOptions(
                        new BrowserType.LaunchOptions()
                                .setArgs(Arrays.asList(
                                    "--no-sandbox",
                                    "--disable-extensions",
                                    "--disable-gpu"))
                );
    }
}
```

#### The Three Annotations

| Annotation | Purpose |
|-----------|---------|
| `@ExtendWith(SerenityJUnit5Extension.class)` | Serenity BDD reporting and `@Steps` injection |
| `@ExtendWith(SerenityPlaywrightExtension.class)` | Registers Playwright pages with Serenity for automatic screenshots |
| `@UsePlaywright` | Manages the full Playwright lifecycle (Playwright, Browser, BrowserContext, Page) |

#### Base Class Pattern

For multiple test classes, extract annotations into a base class:

```java
@ExtendWith(SerenityJUnit5Extension.class)
@ExtendWith(SerenityPlaywrightExtension.class)
@UsePlaywright(SerenityPlaywrightTest.ChromeHeadlessOptions.class)
public abstract class SerenityPlaywrightTest {

    public static class ChromeHeadlessOptions implements OptionsFactory {
        @Override
        public Options getOptions() {
            return new Options()
                    .setHeadless(true)
                    .setLaunchOptions(
                            new BrowserType.LaunchOptions()
                                    .setArgs(Arrays.asList(
                                        "--no-sandbox",
                                        "--disable-extensions",
                                        "--disable-gpu"))
                    );
        }
    }
}
```

Since `@UsePlaywright` is `@Inherited`, all three annotations are inherited by subclasses — test classes only need `extends SerenityPlaywrightTest`.

#### How It Works

The `SerenityPlaywrightExtension` detects when `@UsePlaywright` is present and cooperates with Playwright's own extensions:

- **Parameter Resolution**: `SerenityPlaywrightExtension` defers `Page` parameter resolution to Playwright's `PageExtension`, avoiding conflicts
- **Page Registration**: Uses JUnit 5's `InvocationInterceptor` to capture `Page` instances from `@BeforeEach` and `@Test` method arguments and register them with Serenity for screenshot capture
- **Lifecycle**: Playwright manages browser lifecycle scoping — `Playwright` (per-thread), `Browser` (per-class), `BrowserContext` and `Page` (per-test)

### Tutorials Module

A new `serenity-tutorials` module provides verified, working code samples:

- **REST API Testing** (36 tests): Basic REST operations, Screenplay pattern for APIs, authentication patterns, data-driven tests
- **Advanced Cucumber Patterns** (13 tests): Custom parameter types, data table transformations, lifecycle hooks

Run tutorials: `mvn verify -Ptutorials`

## Maven Coordinates

```xml
<dependency>
    <groupId>net.serenity-bdd</groupId>
    <artifactId>serenity-playwright</artifactId>
    <version>5.2.3</version>
    <scope>test</scope>
</dependency>
```

## Documentation

- [Getting Started with Serenity Playwright](https://serenity-bdd.github.io/docs/playwright/getting-started)
- [Playwright Configuration](https://serenity-bdd.github.io/docs/playwright/configuration)
- [TodoMVC Tutorial](https://serenity-bdd.github.io/docs/playwright/playwright_tutorial_todomvc)

---

**Full Changelog**: https://github.com/serenity-bdd/serenity-core/compare/5.2.2...5.2.3